function barGraphInit(elem,data){function moveLabels(){var t=d3.select("g.axis--x .domain").node().getBBox().width,e=d3.selectAll("g.axis--x g.tick")._groups[0].length,a=t/e/2+1;d3.selectAll("g.axis--x g.tick text").attr("transform",function(){return"translate("+a+", 0)"})}function totalTons(t){var e=0;if(t.length>0)for(i=0;i<t.length;i++)e+=parseInt(t[i][1]);return e}function getDateRange(){return["2016-06-01 00:00:00","2016-07-31 00:00:00"]}elem.innerHTML="",d3.select(window).on("resize",function(){barGraphInit(elem,data)}),pWidth=elem.clientWidth-20,hWidth=elem.clientHeight-20;var margin={top:10,right:30,bottom:30,left:30},width=pWidth-margin.left-margin.right,height=480-margin.top-margin.bottom,x=d3.scaleTime().rangeRound([0,width]),y=d3.scaleLinear().range([height,0]);data.forEach(function(t){d1=t[0],str=String(d1),t.date=new Date(str.substring(0,15)),t.close=t[1]}),dateRange=getDateRange();var histogram=d3.histogram().value(function(t){return t.date});groupBy="week";var xAxisDivisions=function(){return d3.timeWeek.every(1)};switch(x.domain([new Date(dateRange[0]),new Date(dateRange[1])]).nice(1),groupBy){case"day":histogram.thresholds(x.ticks(d3.timeDay)),histogram.domain(x.domain()),xAxisDivisions=function(){return d3.timeWeek.every(1)};break;case"month":histogram.thresholds(x.ticks(d3.timeMonth)),histogram.domain(x.domain()),xAxisDivisions=function(){return d3.timeMonth.every(1)};break;default:x.domain([new Date(dateRange[0]).moveToDayOfWeek(0,-1),new Date(dateRange[1]).moveToDayOfWeek(0)]),histogram.domain(x.domain()),histogram.thresholds(x.ticks(d3.timeWeek))}var bins=histogram(data);1==bins.length,y.domain([0,d3.max(bins,function(t){return 100*(parseInt(totalTons(t)/100)+1)})]);var svg=d3.select(eval(elem)).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");svg.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+height+")").call(d3.axisBottom(x).ticks(xAxisDivisions())),svg.append("g").attr("class","axis axis--y").call(d3.axisLeft(y).tickSize(-width,0,0));var bar=svg.selectAll(".bar").data(bins).enter().append("g").attr("class","bar").attr("transform",function(t){return"translate("+x(t.x0)+","+y(totalTons(t))+")"}).on("mouseover",function(){d3.select(this).select("text").attr("opacity",1)}).on("mouseout",function(){d3.select(this).select("text").attr("opacity",0)});bar.append("rect").attr("x",1).attr("width",function(t){return x(t.x1)-x(t.x0)-1}).attr("height",function(t){return height-y(totalTons(t))}),bar.append("text").attr("dy","-1.0em").attr("y",6).attr("x",function(t){return(x(t.x1)-x(t.x0))/2}).attr("text-anchor","middle").attr("opacity","0.0").text(function(t){return sum=totalTons(t),0==sum&&(sum=""),sum})}